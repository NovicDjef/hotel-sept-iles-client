"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7052],{74671:(e,t,o)=>{o.d(t,{ensureGuestAuth:()=>l});var r=o(49103);let a="guestToken",n="guestUser";async function s(){try{let e=function(){let e=Date.now(),t=Math.floor(1e3*Math.random());return"guest_".concat(e,"_").concat(t,"@hotel-sept-iles.com")}();console.log("\uD83D\uDD11 Cr\xe9ation d'un compte guest automatique...");let t=await r.Ay.post("/api/v1/auth/guest/register",{firstName:"Visiteur",lastName:"Guest",email:e,phone:"0000000000",hotelId:"cmiajn0ck0000r37cliherz4z",password:"Guest123"});if(t.data.success&&t.data.data.tokens.accessToken){let e=t.data.data.tokens.accessToken;return localStorage.setItem(a,e),localStorage.setItem("userToken",e),localStorage.setItem(n,JSON.stringify(t.data.data.user)),console.log("✅ Compte guest cr\xe9\xe9 avec succ\xe8s"),e}return null}catch(t){var e;return console.error("❌ Erreur lors de la cr\xe9ation du compte guest:",(null==(e=t.response)?void 0:e.data)||t.message),null}}async function l(){let e=localStorage.getItem(a)||localStorage.getItem("userToken");if(e){if(console.log("\uD83D\uDD0D V\xe9rification du token existant..."),function(e){try{let t=function(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch(e){return console.error("❌ Erreur lors du d\xe9codage du token:",e),null}}(e);if(!t)return console.log("⚠️ Token invalide - impossible de d\xe9coder"),!1;if("guest"!==t.type)return console.log('⚠️ Token invalide - type n\'est pas "guest":',t.type),!1;let o=Math.floor(Date.now()/1e3);if(t.exp&&t.exp<o)return console.log("⚠️ Token expir\xe9"),!1;return console.log("✅ Token guest valide trouv\xe9"),!0}catch(e){return console.error("❌ Erreur lors de la validation du token:",e),!1}}(e))return console.log("✅ Token guest existant valide"),e;console.log("\uD83D\uDDD1️ Suppression du token invalide"),localStorage.removeItem(a),localStorage.removeItem("userToken"),localStorage.removeItem(n)}return console.log("\uD83D\uDD11 Cr\xe9ation d'un nouveau token guest..."),e=await s()}}}]);