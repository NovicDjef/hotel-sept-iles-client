"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7540],{12967:(e,r,a)=>{a.d(r,{Ay:()=>T,q_:()=>g,Fb:()=>C});var t=a(59267);function o(e){let r={};return Object.entries(e.prix).forEach(e=>{let[a,t]=e;r[parseInt(a)]=t}),{id:e.id,nom:e.nom,description:e.description,descriptionLongue:e.descriptionLongue,categorie:({MASSAGE:"Massage",SPA:"Spa",SOINS:"Soins"})[e.categorie]||"Soins",duree:e.durees,prix:r,image:e.image,bienfaits:e.bienfaits,inclus:e.inclus,isActive:e.isActive}}function s(e){return{id:e.id,nom:e.nom,description:e.description,prixIndividuel:e.prixIndividuel,prixDuo:e.prixDuo,economieIndividuel:e.economieIndividuel,economieDuo:e.economieDuo,services:e.services.map(e=>({id:e.service.id,nom:e.service.nom,description:e.service.description,categorie:e.service.categorie})),isActive:e.isActive}}function l(e){return{id:"amount-".concat(e.montant),code:"",montant:e.montant,populaire:e.isPopular,disponible:!0,isUtilise:!1,dateExpiration:new Date(Date.now()+31536e6).toISOString()}}var i=a(38981);let n={services:[],forfaits:[],certificats:[],categories:[],filteredServices:[],loading:!1,error:null,filters:{category:"tous"}},c=(0,t.zD)("services/fetchServices",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getAllServices:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await i.n.get("spa-services",()=>e(),18e4);console.log("R\xe9ponse API services:",r.data);let t=r.data.data||r.data;console.log("Services API r\xe9cup\xe9r\xe9s:",t);let s=t.map(o);return console.log("Services transform\xe9s:",s),s}catch(e){var s,l;if(console.error("Erreur fetchServices:",e),"ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||"Network Error"===e.message)return t("MAINTENANCE");return t((null==(l=e.response)||null==(s=l.data)?void 0:s.message)||e.message||"Erreur lors de la r\xe9cup\xe9ration des services")}}),d=(0,t.zD)("services/fetchForfaits",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getAllForfaits:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await i.n.get("spa-forfaits",()=>e(),18e4);console.log("R\xe9ponse API forfaits:",r.data);let t=r.data.data||r.data;console.log("Forfaits API r\xe9cup\xe9r\xe9s:",t);let o=t.map(s);return console.log("Forfaits transform\xe9s:",o),o}catch(e){var o,l;if(console.error("Erreur fetchForfaits:",e),"ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||"Network Error"===e.message)return t("MAINTENANCE");return t((null==(l=e.response)||null==(o=l.data)?void 0:o.message)||e.message||"Erreur lors de la r\xe9cup\xe9ration des forfaits")}}),u=(0,t.zD)("services/fetchCertificats",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getCertificatsAmounts:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await i.n.get("spa-certificats",()=>e(),3e5);console.log("R\xe9ponse API certificats amounts:",r.data);let t=r.data.data||r.data;console.log("Certificats amounts API r\xe9cup\xe9r\xe9s:",t);let o=t.map(l);return console.log("Certificats transform\xe9s:",o),o}catch(e){var o,s;if(console.error("Erreur fetchCertificats:",e),"ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||"Network Error"===e.message)return t("MAINTENANCE");return t((null==(s=e.response)||null==(o=s.data)?void 0:o.message)||e.message||"Erreur lors de la r\xe9cup\xe9ration des certificats")}}),p=(0,t.zD)("services/fetchSpaCategories",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getSpaCategories:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await i.n.get("spa-categories",()=>e(),6e5);console.log("R\xe9ponse API cat\xe9gories:",r.data);let t=r.data.data||r.data;return console.log("Cat\xe9gories API r\xe9cup\xe9r\xe9es:",t),t}catch(e){var o,s;if(console.error("Erreur fetchSpaCategories:",e),"ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||"Network Error"===e.message)return t("MAINTENANCE");return t((null==(s=e.response)||null==(o=s.data)?void 0:o.message)||e.message||"Erreur lors de la r\xe9cup\xe9ration des cat\xe9gories")}}),g=(0,t.zD)("services/fetchAllSpaData",async(e,r)=>{let{dispatch:a,rejectWithValue:t}=r;try{let e=(await Promise.allSettled([a(c()).unwrap(),a(d()).unwrap(),a(u()).unwrap(),a(p()).unwrap()])).filter(e=>"rejected"===e.status).map(e=>e.reason);return e.length>0&&console.warn("Certaines requ\xeates ont \xe9chou\xe9:",e),{success:!0}}catch(r){let e=r.message||"Erreur lors de la r\xe9cup\xe9ration des donn\xe9es spa";return console.error("Erreur fetchAllSpaData:",r),t(e)}}),m=(0,t.Z0)({name:"services",initialState:n,reducers:{setServices:(e,r)=>{e.services=r.payload,e.filteredServices=r.payload},setForfaits:(e,r)=>{e.forfaits=r.payload},setCertificats:(e,r)=>{e.certificats=r.payload},setCategory:(e,r)=>{e.filters.category=r.payload,f(e)},resetFilters:e=>{e.filters=n.filters,e.filteredServices=e.services}},extraReducers:e=>{e.addCase(c.pending,e=>{e.loading=!0,e.error=null}),e.addCase(c.fulfilled,(e,r)=>{e.loading=!1,e.services=r.payload,f(e)}),e.addCase(c.rejected,(e,r)=>{e.loading=!1,e.error=r.payload}),e.addCase(d.fulfilled,(e,r)=>{e.forfaits=r.payload}),e.addCase(d.rejected,(e,r)=>{console.error("Erreur forfaits:",r.payload)}),e.addCase(u.fulfilled,(e,r)=>{e.certificats=r.payload}),e.addCase(u.rejected,(e,r)=>{}),e.addCase(p.fulfilled,(e,r)=>{e.categories=r.payload}),e.addCase(p.rejected,(e,r)=>{}),e.addCase(g.pending,e=>{e.loading=!0,e.error=null}),e.addCase(g.fulfilled,e=>{e.loading=!1}),e.addCase(g.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}});function f(e){let r=e.services;if("tous"!==e.filters.category){let a={massage:"Massage",spa:"Spa",soins:"Soins"}[e.filters.category.toLowerCase()];a&&(r=r.filter(e=>e.categorie===a))}e.filteredServices=r}let{setServices:h,setForfaits:v,setCertificats:y,setCategory:C,resetFilters:E}=m.actions,T=m.reducer},18224:(e,r,a)=>{a.d(r,{Ay:()=>y,RM:()=>l,dr:()=>h,R3:()=>g,_W:()=>f,xA:()=>p});var t=a(59267),o=a(38981);let s={rooms:[],filteredRooms:[],loading:!1,error:null,filters:{category:"Toutes",minPrice:0,maxPrice:1e4,capacity:1,available:null,checkIn:"",checkOut:""}},l=(0,t.zD)("rooms/fetchRooms",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getAllRoomTypes:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await o.n.get("room-types",()=>e(),18e4);console.log("✅ R\xe9ponse API room-types:",r.data);let t=r.data.data,s=t.roomTypes||t||[];if(console.log("\uD83D\uDCE6 Types de chambres (inventaire):",s),s.length>0&&(console.log("\uD83D\uDD0D Structure du premier roomType:",s[0]),console.log("\uD83D\uDD0D Cl\xe9s disponibles:",Object.keys(s[0]))),!Array.isArray(s))throw console.error("❌ roomTypes n'est pas un tableau:",s),Error("Format de donn\xe9es invalide: roomTypes doit \xeatre un tableau");let l=s.map((e,r)=>{console.log("\uD83D\uDD04 Transformation roomType ".concat(r+1,":"),e);try{let a=function(e){let r={ac:"Climatisation",tv:"T\xe9l\xe9vision",wifi:"Wi-Fi",minibar:"Minibar",balcony:"Balcon",jacuzzi:"Jacuzzi",dining:"Salle \xe0 manger",kitchen:"Cuisine",safe:"Coffre-fort",phone:"T\xe9l\xe9phone",hairdryer:"S\xe8che-cheveux",bathtub:"Baignoire",shower:"Douche",desk:"Bureau",sofa:"Canap\xe9"},a=e.amenities&&"object"==typeof e.amenities?Object.entries(e.amenities).filter(e=>{let[r,a]=e;return!0===a}).map(e=>{let[a,t]=e;return r[a]||a.charAt(0).toUpperCase()+a.slice(1)}):[],t=e.roomType||e.type||"STANDARD",o=e.category?e.category.includes("Premium")?"Premium":e.category.includes("Business")?"Business":e.category.includes("Famille")?"Famille":"Standard":({DELUXE:"Premium",SUITE:"Premium",PRESIDENTIAL:"Premium",EXECUTIVE:"Business",STANDARD:"Standard",DOUBLE:"Standard",SIMPLE:"Standard",FAMILY:"Famille",CONDO:"Famille",TWIN:"Standard"})[t.toUpperCase()]||"Standard";return{id:e.id,nom:e.name||"Chambre ".concat(t),type:t,categorie:o,description:e.description||"Chambre confortable et bien \xe9quip\xe9e",prix:e.basePrice||0,prixWeekend:e.weekendPrice||e.basePrice||0,capacite:e.capacity||1,superficie:e.size||25,images:e.images&&e.images.length>0?e.images:["/images/chambres/0.webp"],equipements:a,note:4.5,avis:0,disponible:!0}}(e);return console.log("✅ Transform\xe9 ".concat(r+1,":"),a),a}catch(a){return console.error("❌ Erreur transformation ".concat(r+1,":"),a,e),null}}).filter(e=>null!==e);return console.log("✅ Chambres transform\xe9es (total):",l.length,l),l}catch(e){var s,l;if(console.error("❌ Erreur fetchRooms:",e),"ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||"Network Error"===e.message)return t("MAINTENANCE");return t((null==(l=e.response)||null==(s=l.data)?void 0:s.message)||e.message||"Erreur inconnue")}}),i=(0,t.zD)("rooms/checkAvailability",async(e,r)=>{let{roomId:t,checkIn:o,checkOut:s}=e,{rejectWithValue:l}=r;try{let{checkChambreAvailability:e}=await Promise.all([a.e(5125),a.e(8893)]).then(a.bind(a,1274)),r=await e({chambreId:t,dateDebut:o,dateFin:s});return{roomId:t,available:r.data.available}}catch(e){var i,n;return l((null==(n=e.response)||null==(i=n.data)?void 0:i.message)||e.message||"Erreur inconnue")}}),n=(0,t.Z0)({name:"rooms",initialState:s,reducers:{setRooms:(e,r)=>{e.rooms=r.payload,e.filteredRooms=r.payload},setCategory:(e,r)=>{e.filters.category=r.payload,c(e)},setPriceRange:(e,r)=>{e.filters.minPrice=r.payload.min,e.filters.maxPrice=r.payload.max,c(e)},setCapacity:(e,r)=>{e.filters.capacity=r.payload,c(e)},setAvailability:(e,r)=>{e.filters.available=r.payload,c(e)},setDates:(e,r)=>{e.filters.checkIn=r.payload.checkIn,e.filters.checkOut=r.payload.checkOut},resetFilters:e=>{e.filters=s.filters,e.filteredRooms=e.rooms},updateRoomAvailability:(e,r)=>{let a=e.rooms.find(e=>e.id===r.payload.roomId.toString());a&&(a.disponible=r.payload.available),c(e)}},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}),e.addCase(l.fulfilled,(e,r)=>{e.loading=!1,e.rooms=r.payload,c(e)}),e.addCase(l.rejected,(e,r)=>{e.loading=!1,e.error=r.payload}),e.addCase(i.fulfilled,(e,r)=>{let a=e.rooms.find(e=>e.id===r.payload.roomId.toString());a&&(a.disponible=r.payload.available),c(e)})}});function c(e){console.log("\uD83D\uDD27 D\xe9but applyFilters - Total chambres:",e.rooms.length),console.log("\uD83D\uDD27 Filtres actifs:",e.filters);let r=e.rooms;if("Toutes"!==e.filters.category){let a=r.length;r=r.filter(r=>r.categorie===e.filters.category),console.log('\uD83D\uDCC1 Filtre cat\xe9gorie "'.concat(e.filters.category,'": ').concat(a," -> ").concat(r.length))}let a=r.length,t=r.filter(r=>r.prix>=e.filters.minPrice&&r.prix<=e.filters.maxPrice);if(t.length<r.length){let o=r.filter(r=>r.prix<e.filters.minPrice||r.prix>e.filters.maxPrice);console.log("\uD83D\uDCB0 Filtre prix (".concat(e.filters.minPrice,"$ - ").concat(e.filters.maxPrice,"$): ").concat(a," -> ").concat(t.length)),console.log("❌ Chambres exclues par prix:",o.map(e=>({nom:e.nom,prix:e.prix})))}let o=(r=t).length;if((r=r.filter(r=>r.capacite>=e.filters.capacity)).length<o&&console.log("\uD83D\uDC65 Filtre capacit\xe9 (>= ".concat(e.filters.capacity,"): ").concat(o," -> ").concat(r.length)),null!==e.filters.available){let a=r.length;(r=r.filter(r=>r.disponible===e.filters.available)).length<a&&console.log("✅ Filtre disponibilit\xe9 (".concat(e.filters.available,"): ").concat(a," -> ").concat(r.length))}console.log("✅ Fin applyFilters - Chambres filtr\xe9es:",r.length),e.filteredRooms=r}let{setRooms:d,setCategory:u,setPriceRange:p,setCapacity:g,setAvailability:m,setDates:f,resetFilters:h,updateRoomAvailability:v}=n.actions,y=n.reducer},38981:(e,r,a)=>{a.d(r,{n:()=>o});class t{async get(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e5,t=Date.now(),o=this.cache.get(e);if(o&&t-o.timestamp<o.ttl)return console.log("✅ Cache HIT: ".concat(e)),o.data;console.log("⚠️ Cache MISS: ".concat(e));try{let o=await r();return this.cache.set(e,{data:o,timestamp:t,ttl:a}),o}catch(r){if(o)return console.log("⚠️ Using stale cache for: ".concat(e)),o.data;throw r}}invalidate(e){this.cache.delete(e),console.log("\uD83D\uDDD1️ Cache invalidated: ".concat(e))}invalidatePattern(e){Array.from(this.cache.keys()).forEach(r=>{r.includes(e)&&(this.cache.delete(r),console.log("\uD83D\uDDD1️ Cache invalidated: ".concat(r)))})}clear(){this.cache.clear(),console.log("\uD83D\uDDD1️ Cache cleared")}cleanup(){let e=Date.now();Array.from(this.cache.keys()).forEach(r=>{let a=this.cache.get(r);a&&e-a.timestamp>=a.ttl&&this.cache.delete(r)})}constructor(){this.cache=new Map}}let o=new t;setInterval(()=>{o.cleanup()},6e5)},49103:(e,r,a)=>{a.d(r,{Ay:()=>n,Yb:()=>o});var t=a(95125);let o="cmiajn0ck0000r37cliherz4z",s=["/api/v1/rooms","/api/v1/room-types","/api/v1/auth/guest","/api/v1/reservations/calculate","/api/v1/reservations/availability","/api/v1/reservations/guest","/api/v1/reviews/hotel","/api/v1/chat/start","/api/v1/chat/"],l=["/api/v1/spa/services","/api/v1/spa/forfaits","/api/v1/spa/certificats","/api/v1/spa/statistics","/api/v1/reservations/spa-categories"],i=t.A.create({baseURL:"https://apihotel.novic.dev",timeout:15e3,headers:{"Content-Type":"application/json"},responseType:"json",withCredentials:!1});i.interceptors.request.use(async e=>{let r=(e=>!!e&&s.some(r=>e.includes(r)))(e.url),a=(e=>!!e&&l.some(r=>e.includes(r)))(e.url);if(console.log("\uD83D\uDD35 API Request:",{baseURL:e.baseURL,url:e.url,fullURL:"".concat(e.baseURL).concat(e.url),isPublic:r,isSemiPublic:a,requiresAuth:!r&&!a}),r)e.withCredentials=!1,delete e.headers.Authorization;else if(a){e.withCredentials=!1;try{{let r=localStorage.getItem("userToken");r?(e.headers.Authorization="Bearer ".concat(r),console.log("\uD83D\uDD11 Token envoy\xe9 pour route semi-publique")):(console.log("⚠️ Pas de token trouv\xe9, requ\xeate sans auth"),delete e.headers.Authorization)}}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration du token:",r),delete e.headers.Authorization}}else{e.withCredentials=!1;try{{let r=localStorage.getItem("userToken");r?(e.headers.Authorization="Bearer ".concat(r),console.log("\uD83D\uDD11 Token envoy\xe9 pour route priv\xe9e:",r.substring(0,30)+"...")):console.warn("⚠️ Aucun token trouv\xe9 pour route priv\xe9e")}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration du token:",e)}}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>{if(e.response){let{status:r,data:a}=e.response;switch(r){case 401:localStorage.removeItem("userToken");break;case 403:console.error("Acc\xe8s interdit");break;case 404:console.error("Ressource non trouv\xe9e");break;case 500:console.error("Erreur serveur");break;default:console.error("Erreur API:",(null==a?void 0:a.message)||e.message)}}else e.request?console.error("Pas de r\xe9ponse du serveur"):console.error("Erreur de configuration:",e.message);return Promise.reject(e)});let n=i},51581:(e,r,a)=>{a.d(r,{Ay:()=>u,YT:()=>o});var t=a(59267);let o=(0,t.zD)("auth/registerGuest",async(e,r)=>{var t,o,s,l,i,n,c,d;let{rejectWithValue:u}=r;try{console.log("\uD83D\uDCDD Donn\xe9es envoy\xe9es \xe0 registerGuest:",JSON.stringify(e,null,2));let{registerGuest:r}=await a.e(1274).then(a.bind(a,1274)),o=await r(e);return console.log("✅ R\xe9ponse registerGuest:",o.data),(null==(t=o.data)?void 0:t.data)&&(localStorage.setItem("user",JSON.stringify(o.data.data.user)),localStorage.setItem("accessToken",o.data.data.accessToken),o.data.data.refreshToken&&localStorage.setItem("refreshToken",o.data.data.refreshToken)),o.data.data}catch(a){console.error("❌ Erreur registerGuest:",a),console.error("\uD83D\uDCCB D\xe9tails erreur:",null==(o=a.response)?void 0:o.data);let e=(null==(l=a.response)||null==(s=l.data)?void 0:s.message)||a.message||"Erreur lors de l'enregistrement",r=(null==(n=a.response)||null==(i=n.data)?void 0:i.error)||(null==(d=a.response)||null==(c=d.data)?void 0:c.errors);return r&&console.error("\uD83D\uDD0D D\xe9tails validation:",r),u(e)}}),s=(0,t.zD)("auth/getCurrentUser",async(e,r)=>{let{rejectWithValue:t}=r;try{let{getCurrentUser:e}=await a.e(1274).then(a.bind(a,1274));return(await e()).data.data}catch(e){var o,s;return t((null==(s=e.response)||null==(o=s.data)?void 0:o.message)||e.message)}}),l=(0,t.Z0)({name:"auth",initialState:{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,loading:!1,error:null,...(()=>{{let e=localStorage.getItem("user"),r=localStorage.getItem("accessToken"),a=localStorage.getItem("refreshToken");if(e&&r)return{user:JSON.parse(e),accessToken:r,refreshToken:a||null,isAuthenticated:!0}}return{}})()},reducers:{logout:e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1,e.error=null,localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")},loginSuccess:(e,r)=>{e.user=r.payload.user,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken||null,e.isAuthenticated=!0,e.error=null,localStorage.setItem("user",JSON.stringify(r.payload.user)),localStorage.setItem("accessToken",r.payload.accessToken),r.payload.refreshToken&&localStorage.setItem("refreshToken",r.payload.refreshToken)},setUser:(e,r)=>{e.user=r.payload,e.isAuthenticated=!0},clearError:e=>{e.error=null}},extraReducers:e=>{e.addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.loading=!1,e.user=r.payload.user,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken,e.isAuthenticated=!0}).addCase(o.rejected,(e,r)=>{e.loading=!1,e.error=r.payload}),e.addCase(s.pending,e=>{e.loading=!0,e.error=null}).addCase(s.fulfilled,(e,r)=>{e.loading=!1,e.user=r.payload,e.isAuthenticated=!0}).addCase(s.rejected,(e,r)=>{e.loading=!1,e.error=r.payload,e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1,localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")})}}),{logout:i,loginSuccess:n,setUser:c,clearError:d}=l.actions,u=l.reducer}}]);