"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4671,7052],{49103:(e,r,o)=>{o.d(r,{Ay:()=>i,Yb:()=>s});var t=o(95125);let s="cmiajn0ck0000r37cliherz4z",a=["/api/v1/rooms","/api/v1/room-types","/api/v1/auth/guest","/api/v1/reservations/calculate","/api/v1/reservations/availability","/api/v1/reservations/guest","/api/v1/reviews/hotel","/api/v1/chat/start","/api/v1/chat/"],n=["/api/v1/spa/services","/api/v1/spa/forfaits","/api/v1/spa/certificats","/api/v1/spa/statistics","/api/v1/reservations/spa-categories"],l=t.A.create({baseURL:"https://apihotel.novic.dev",timeout:15e3,headers:{"Content-Type":"application/json"},responseType:"json",withCredentials:!1});l.interceptors.request.use(async e=>{let r=(e=>!!e&&a.some(r=>e.includes(r)))(e.url),o=(e=>!!e&&n.some(r=>e.includes(r)))(e.url);if(console.log("\uD83D\uDD35 API Request:",{baseURL:e.baseURL,url:e.url,fullURL:"".concat(e.baseURL).concat(e.url),isPublic:r,isSemiPublic:o,requiresAuth:!r&&!o}),r)e.withCredentials=!1,delete e.headers.Authorization;else if(o){e.withCredentials=!1;try{{let r=localStorage.getItem("userToken");r?(e.headers.Authorization="Bearer ".concat(r),console.log("\uD83D\uDD11 Token envoy\xe9 pour route semi-publique")):(console.log("⚠️ Pas de token trouv\xe9, requ\xeate sans auth"),delete e.headers.Authorization)}}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration du token:",r),delete e.headers.Authorization}}else{e.withCredentials=!1;try{{let r=localStorage.getItem("userToken");r?(e.headers.Authorization="Bearer ".concat(r),console.log("\uD83D\uDD11 Token envoy\xe9 pour route priv\xe9e:",r.substring(0,30)+"...")):console.warn("⚠️ Aucun token trouv\xe9 pour route priv\xe9e")}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration du token:",e)}}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,e=>{if(e.response){let{status:r,data:o}=e.response;switch(r){case 401:localStorage.removeItem("userToken");break;case 403:console.error("Acc\xe8s interdit");break;case 404:console.error("Ressource non trouv\xe9e");break;case 500:console.error("Erreur serveur");break;default:console.error("Erreur API:",(null==o?void 0:o.message)||e.message)}}else e.request?console.error("Pas de r\xe9ponse du serveur"):console.error("Erreur de configuration:",e.message);return Promise.reject(e)});let i=l},74671:(e,r,o)=>{o.d(r,{ensureGuestAuth:()=>l});var t=o(49103);let s="guestToken",a="guestUser";async function n(){try{let e=function(){let e=Date.now(),r=Math.floor(1e3*Math.random());return"guest_".concat(e,"_").concat(r,"@hotel-sept-iles.com")}();console.log("\uD83D\uDD11 Cr\xe9ation d'un compte guest automatique...");let r=await t.Ay.post("/api/v1/auth/guest/register",{firstName:"Visiteur",lastName:"Guest",email:e,phone:"0000000000",hotelId:"cmiajn0ck0000r37cliherz4z",password:"Guest123"});if(r.data.success&&r.data.data.tokens.accessToken){let e=r.data.data.tokens.accessToken;return localStorage.setItem(s,e),localStorage.setItem("userToken",e),localStorage.setItem(a,JSON.stringify(r.data.data.user)),console.log("✅ Compte guest cr\xe9\xe9 avec succ\xe8s"),e}return null}catch(r){var e;return console.error("❌ Erreur lors de la cr\xe9ation du compte guest:",(null==(e=r.response)?void 0:e.data)||r.message),null}}async function l(){let e=localStorage.getItem(s)||localStorage.getItem("userToken");if(e){if(console.log("\uD83D\uDD0D V\xe9rification du token existant..."),function(e){try{let r=function(e){try{let r=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch(e){return console.error("❌ Erreur lors du d\xe9codage du token:",e),null}}(e);if(!r)return console.log("⚠️ Token invalide - impossible de d\xe9coder"),!1;if("guest"!==r.type)return console.log('⚠️ Token invalide - type n\'est pas "guest":',r.type),!1;let o=Math.floor(Date.now()/1e3);if(r.exp&&r.exp<o)return console.log("⚠️ Token expir\xe9"),!1;return console.log("✅ Token guest valide trouv\xe9"),!0}catch(e){return console.error("❌ Erreur lors de la validation du token:",e),!1}}(e))return console.log("✅ Token guest existant valide"),e;console.log("\uD83D\uDDD1️ Suppression du token invalide"),localStorage.removeItem(s),localStorage.removeItem("userToken"),localStorage.removeItem(a)}return console.log("\uD83D\uDD11 Cr\xe9ation d'un nouveau token guest..."),e=await n()}}}]);